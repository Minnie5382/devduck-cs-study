2장. 데이터를 주고받는 원리
-----------------

### 05. 프로토콜

#### - 프로토콜의 개념
> 네트워크 상에서 통신할 데이터의 구성이나 주고 받는 절차 등이 정의되어 있는 통신 규약, 규칙, 약속 

우리가 택배를 보낼 때 택배 송장에 여러 정보를 써서 보낸다. - 출발지, 도착지, 내용물, 소포 종류(특급...)

이 때 택배사마다 이 송장을 쓰는 양식, 이 택배가 목적지까지 도착하는 방법(선박, 트럭, 비행기...)은 다양할 수 있다. 이것들을 프로토콜로 비유할 수 있다.

프로토콜은 수많은 종류가 있고, 두 기기가 같은 프로토콜을 사용해야 통신할 수 있다. 국제 표준은 ISO, IEEE 등의 표준화 단체에서 규정하고 있다.


#### - 종류
|프로토콜|용도|사용하는 곳|
|-|-|-|
|IEEE 802.3|IEEE가 규정하는 이더넷 규격의 프로토콜|LAN 케이블|
|IEEE 302.11|IEEE가 규정하는 무선 LAN 규격의 프로토콜|Wi-Fi|
|IP|여러 네트워크를 구성하는 프로토콜|인터넷|
|TPC|신뢰성을 높인 프로토콜|인터넷|
|UDP|속도와 편의성을 우선으로 하는 프로토콜|인터넷|
|HTTP|웹 브라우저와 서버 간 통신 프로토콜|웹|

### 06. 네트워크 계층
#### - 네트워크를 계층으로 나누는 이유
한 컴퓨터에서 다른 컴퓨터로 데이터를 보내는 과정에서 사용되는 프로토콜이 매우 다양하고, 많다.

많은 프로토콜을 한 애플리케이션에서 모두 처리하는 것은 비효율적 -> 단계별로 계층을 나누어 분담한다.


#### - 프로토콜 스택
스택 : 상자를 쌓듯이, 쌓아올리는 구조

네트워크 계층 별로 프로토콜이 스택처럼 쌓이게 된다. 용도 별로 프로토콜의 종류는 다양하고, 각 계층 별로 사용하는 프로토콜이 다르다. 

#### - 프로토콜 구조

> 데이터 단위의 기본 구조 : 헤더 + 페이로드

페이로드는 데이터, 헤더는 프로토콜이 추가한 주소 등의 정보가 들어간다.

상위 계층의 헤더 + 페이로드 = 하위 계층의 페이로드

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/944e97d0-8fab-438e-bf06-03294f0a740d)

데이터를 보낼 때는 7계층 -> 1계층으로 이동 (캡슐화)

데이터를 받을 때는 1계층 -> 7계층으로 이동 (역캡슐화)



각 계층을 거치며 겹겹이 쌓이는 구조, 마치 상자 안의 상자처럼 (스택)



### 07. 네트워크 모델
#### - OSI 참조 모델과 TCP/IP 모델
>OSI 참조 모델 : 1970년대 국제표준화기구 ISO에서 규정한 네트워크 모델의 표준
>
>TCP/IP 모델 : OSI 참고 모델을 기반으로 좀 더 간소화된 네트워크 모델. 인터넷에서 사용된다.

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/eadd6148-3000-4827-8e1b-97773094910c)
|계층|명칭|주요 프로토콜|
|-|-|-|
|7계층|애플리케이션 계층|HTTP, DNS, FTP|
|6계층|표현 계층|SMTP, FTP|
|5계층|세션 계층|TLS|
|4계층|전송 계층|TCP, UDT|
|3계층|네트워크 계층|IP|
|2계층|데이터 링크 계층|IEEE 802.3(이더넷), IEEE802.11(무선랜)|
|1계층|물리 계층|광섬유|



### 08. TCP/IP
#### - IP, TCP, UDP
IP와 TCP와 UDP는 모두 프로토콜의 종류이다. 근데 셋의 관계가 긴밀하여 같이 다니는 경우가 많고, 그냥 묶어서 부르기도 함.

>IP(Internet Protocol) : 컴퓨터마다 고유한 IP 주소를 할당하고 이 IP 주소를 통해 통신하는 프로토콜 (인터넷 계층에서 사용)

IP는 현재도 널리 쓰이지만, 본래 단점이 많다.(비연결성, 비신뢰성, 앱 구분 불가) 그래서 이를 보완하기 위해 있는 것이 TCP이다.

> TCP : IP 프로토콜이 정의하지 않는 시퀀스 번호(패킷 번호), 응답 확인 번호(자기 다음에 와야되는 패킷 번호), 세션 플래그(세션의 상태), 포트 번호 등 통신의 안정성을 위한 것들을 정의하는 프로토콜. (전송 계층에서 사용)
> 
> UDP : TCP처럼 IP 프로토콜을 보완하는 프로토콜이지만, 포트 번호 정도만 포함하고 있어 더 빠르고 편리하다.(전송 계층에서 사용)

###### 현재 대부분의 인터넷 통신이 IP와 TCP 조합으로 이루어지며, 이를 한데 묶어서 TCP/IP 프로토콜이라고 한다. 그리고 앞서 배웠던 TCP/IP 네트워크 모델도 TCP/IP 프로토콜을 중심으로 구축되었기 때문에 그런 이름이 붙여졌다.

### 09 & 10.
#### - IPv4/IPv6

TCP/IP 프로토콜을 사용하는 인터넷에서는 컴퓨터의 기본적인 주소로 IP 주소를 사용한다. IANA에서 관리한다.
버전은 IPv4와 IPv6 두 가지가 있는데, 서로 호환은 되지 않고 현재는 혼용하여 사용한다.

IPv4는 아래 그림처럼 구성되어 있다.
![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/c837c699-7816-40c9-aa9d-9365188a0a6b)

네트워크에서는 8 bits = 1 byte 단위를 옥텟이라고 한다.

IPv4는 32 bits = 2의 8제곱 = 약 43억개의 주소를 사용할 수 있다. 

그러나 인터넷이 확장됨에 따라 이 숫자가 부족해져서 더 큰 숫자의 주소를 표현할 수 있는 IPv6가 고안되었다. IPv6는 128 bits로 구성되어 있어 거의 무한정에 가까운 주소를 표현할 수 있다.

아직 IPv6의 보급이 완료되지 않아 현재 대부분의 웹 서비스는 IPv4를 기반으로 작동중이다.
<br><br><br>
뿐만 아니라 IPv6는 
- 헤더가 단순하여 처리가 쉽다.
- 프로토콘 단계에서 암호화가 가능.
- 계층 구조가 엄격하여 라우팅 효율 좋음.
- MAC 주소로 IPv6를 자동 생성할 수 있다.

<br>

#### - 글로벌 IP/프라이빗 IP
각 LAN은 라우터에 연결되어 있고 이 라우터는 전 세계 네트워크인 인터넷에 연결되어 있다. 
>글로벌 IP : 인터넷에 직접 연결되어 있는 라우터 등의 게이트웨이가 갖는 IP 주소. 인터넷에서 사용. 인터넷 내에서 유일함
>
>프라이빗 IP : LAN 내부에서 디바이스들이 사용하는 IP 주소. LAN 내부에서만 사용. LAN 내에서 유일함

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/1b6fb1f0-e05d-4ceb-95a1-db0108c21f77)

### 11. MAC 주소
#### - 구조

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/becf95ea-d4e8-48c2-a550-271a159ff771)

제조사 번호는 벤더 코드라고도 한다. 벤더 코드만 해도 140조 개이고, 하나의 벤더 코드로 140조 개의 MAC 주소를 만들 수 있다.

IEEE에서 제조사마다 벤더 코드를 하나씩 부여해주는데, 자회사 등이 있는 대기업은 벤더 코드를 여러 개 가질 수 있다.

MAC 주소는 원래 변경할 수 없는 정보지만, 최근엔 보안을 이유로 랜덤 MAC 주소를 사용하도록 설정할 수 있다.


#### - IP 주소 vs MAC 주소
|구분|MAC|IP|
|-|-|-|
|프로토콜|이더넷(2계층 이하)|TCP/IP(3계층 이상)|
|식별 대상|디바이스(단말기)|네트워크 호스트|
|식별자 수|280조 개|43억 개|
|관리 단체|IANA|IEEE|


### 12. ARP
#### - ARP란?
통신을 하기 위해서는 IP 주소 뿐만아니라 MAC 주소도 필요하다.
IP 주소는 논리적인 주소여서, 라우팅(경로 설정) 시 사용되고 실질적으로 데이터를 토스할 때는 MAC 주소를 이용해 보내기 때문이다. 

하지만 그렇다고 IP 주소 없이 MAC 주소만으로는 통신이 될 수 없다. MAC은 하드웨어 기기의 고유 번호이기 때문에 물리적인 주소인데, 이는 라우팅이 어렵다.

이렇게 IP 주소를 이용하여 MAC 주소를 알아낼 때 사용하는 프로토콜이 ARP(Address Resolution Protocol)이다.


#### - ARP 작동 방식

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/e603abfc-4ec5-42fa-9811-8dfd010aebb7)

LAN 내의 모든 장치에게 패킷을 전송하는 것은 브로드캐스트 라고 한다. 즉 이 패킷은 모든 장치가 수신하게 된다.

MAC 주소를 알고싶은 IP 주소가 들어있는 패킷을 브로드캐스트하면, 해당하는 장치가 '그거 나야, 내 MAC 주소 XX-XX 야.' 라고 알려준다.

실제로는 매 통신마다 ARP를 통해 조회하진 않고, 게이트웨이(라우터)가 IP주소-MAC주소 표를 만들어두고, 필요할 때는 라우터에게 문의해서 MAC 주소를 확인한다. 

###### 게이트웨이는 관리자 역할을 하는 기기로, LAN 내의 기기들이 본인이 모르는 정보를 문의하기도 하고 LAN 외부와의 통신도 담당한다. 각 장치들은 모두 이러한 '게이트웨이'라는 개념을 갖고 있기 때문에 게이트웨이 기기의 IP 주소를 미리 설정해둔다.


### 13. 포트 번호
#### - 포트 번호란
기기의 소프트웨어 상에서 돌아가는 애플리케이션을 특정하기 위해 애플리케이션마다 하나씩 할당받는 번호.
TCP/UDP 헤더의 상위 16 bits에 해당하고 16 bits이므로 0~65535 범위의 숫자를 표현할 수 있다. 

>'Hello'라는 메시지를 받았는데, 채팅 앱으로 온건지 배달 앱으로 온건지 알 수가 없어!

이런 불상사를 막기 위해 TCP/UDP가 어떤 앱에서 왔고(출발지 포트 번호), 어떤 앱으로 가야하는지(도착지 포트 번호)를 헤더에 추가해놓는 것이다.


#### - 잘 알려진 포트(well-known port)
0~1023 범위의 포트는 잘 알려진 포트라고 하고, 주요 애플리케이션(HTTP, DNS, FTP 등) 에 할당한다.

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/4757b922-6b86-4d18-a0ad-b0887c0d450e)
###### 서버 개발자로 일하다보면 자주 접하게 될 포트들이니 기억해두자.


### 14. 회선 교환 방식
#### - 유선 전화
모든 전화기를 서로 선으로 연결하기란 쉽지 않기 때문에, LAN의 허브처럼 중간에 교환대를 두어 모든 전화기를 교환대에 연결한다. 

교환대로 전화를 걸면 교환원이 이를 받아서 연결을 원하는 상대를 확인한 후, 전화를 연결해주는 방식. 교환대끼리 이어주는 상위 교환대도 있어서, 이런식으로 해외까지 커버할 수 있음.

이런 통신 방식을 회선 교환 방식이라고 한다.

회선 교환 방식은 일대일 연결을 생성하므로 한 통화 당 한 회선을 독점하는데, 이 방식은 통화량이 많아지면 비효율적이다. 따라서 현재는 회선을 다중화하고 통신은 디지털화 하여 효율을 높였다. 기본 원리는 회선 교환 방식과 동일하다.

### 15. 패킷 교환 방식
#### - 패킷 교환 방식의 원리와 장점
>회선 교환 방식: 한 통신이 끝날 때까지 한 회선을 독점하는 형태.
>
>패킷 교환 방식: 데이터를 여러 개의 패킷으로 쪼개서 패킷들을 회선에 실어 보내는 형식.

패킷 교환 방식은 매번 회선을 연결할 필요가 없어 아무때나 데이터를 보낼 수 있고, 동시에 여러 개의 데이터를 보낼 수 있다.

그러나 한 데이터를 패킷으로 쪼갠 만큼, 패킷 내에 원본 데이터와 패킷에 대한 관리 정보를 자세히 명시해놔야 한다. 안 그러면 패킷을 잃어버리거나 순서가 꼬일 수 있다.

#### - 패킷이 만들어지는 이야기

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/a140a5d6-57b9-4f21-b140-1880dd4b14a7)

>(이후 설명은 TCP/IP 5계층 기준입니다)
>앞서 상위 계층에서 하위 계층으로 내려갈수록 헤더가 붙고, 이를 캡슐화라고 배웠었다.
>
>네트워크 계층을 크게 애플리케이션/시스템으로 나눴을 때, 애플리케이션 단에서 시스템 단으로 데이터를 내려보낼 때 소켓이 필요하다.
>소켓은 쉽게 말해 TCP, UDP 등의 프로토콜이라고 생각하면 된다. 
>응용 계층에서 내려온 데이터가 L4에서 TCP/UDP를 만나면 일정 단위로 분할되고(segmentation), 우리가 알던 것처럼 TCP/UDP 헤더가 붙게 된다. dl 헤더가 붙은 세그먼트 조각들은 또 L3로 내려가서 IP 프로토콜을 만나 IP 헤더가 붙는데 이걸 패킷(packet)이라고 한다. 이 패킷은 L2로 내려가 이더넷 프로토콜을 만나 또 이더넷 헤더가 붙어서 '프레임'이 된다.
>

![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/ec04a337-cb34-4603-bd81-6f6e066650a6)

#### - 패킷의 구조
![image](https://github.com/Minnie5382/devduck-cs-study/assets/97179789/fb6323b8-72d9-4100-ae4d-ab77e07483d8)


### 16. 라우터
#### - 라우터의 기능
라우터는 LAN과 LAN을 연결하고, 패킷의 이동 결로를 그리고, 그린 경로에 따라 패킷을 토스한다. (라우팅)

앞서 배웠듯이 라우터는 내 LAN으로 온 패킷은 내가 취하고, 아닌 패킷은 인접한(이웃한, 직접 연결된) 라우터로 토스한다.

그래서 라우터는 본인의 LAN과 연결하는 LAN 포트와 다른 라우터와 연결하는 WAN 포트가 둘 다 있다.

이런 내부 LAN과 외부 인터넷의 경계에 설치하는 라우터를 에지 라우터라고 한다. = 게이트웨이


### 17. 엑세스 포인트
#### - 엑세스 포인트 = 무선 LAN의 허브 = Wi-Fi
지금까지 유선을 가정하고 네트워크를 설명했는데, 여기서 나오는 허브의 개념이 무선 LAN에서는 엑세스 포인트이다. 

IEEE 802.11 규격 중 무선 LAN 규격(Wi-Fi)을 사용한다.

시중에 나와있는 대부분의 Wi-Fi 장치는 대부분 라우터(3L) + 엑세스 포인트(2L) 기능을 통합한 기기이다.

#### - 인프라스트럭처 모드, 애드혹 모드
>일반적으로 액세스 포인트를 이용해 연결하는 형태 : 인프라스트럭처 모드
>
>엑세스 포인트 없이 장치끼리 직접 무선 링크하는 형태 : 애드혹(Ad-hoc) 모드
>
>애드혹: 임시로 만든

